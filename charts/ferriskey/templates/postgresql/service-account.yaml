{{- if and .Values.postgresql.enabled .Values.postgresql.serviceAccount.create }}
{{- $annotations := merge dict .Values.common.serviceAccount.annotations .Values.postgresql.serviceAccount.annotations -}}
{{- $labels := merge dict .Values.common.serviceAccount.labels .Values.postgresql.serviceAccount.labels -}}
{{- $automountServiceAccountToken := include "ferriskey.util.bool" (dict "value" .Values.postgresql.serviceAccount.automountServiceAccountToken "default" .Values.common.serviceAccount.automountServiceAccountToken) -}}
apiVersion: v1
kind: ServiceAccount
metadata:
  name: {{ include "ferriskey.postgresql.serviceAccountName" . }}
  {{- with $annotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
  labels:
    {{- include "ferriskey.postgresql.labels" . | nindent 4 }}
    {{- with $labels }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
{{- if ne $automountServiceAccountToken "" }}
automountServiceAccountToken: {{ $automountServiceAccountToken }}
{{- end }}
{{- end }}
